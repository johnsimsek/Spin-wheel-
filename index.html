<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Tattoo Of The Day</title>

<style>
html, body{
  margin:0;
  height:100%;
  background:#0b0b0f;
  font-family:Arial, sans-serif;
  color:#fff;
}

/* ===== POPUP OVERLAY (HIDDEN FIRST) ===== */
#overlayBg{
  position:fixed !important;
  top:0; left:0;
  width:100vw;
  height:100vh;
  background:rgba(0,0,0,.75);
  backdrop-filter:blur(8px);
  display:none;                 /* first hidden */
  justify-content:center;
  align-items:center;
  padding:20px;
  z-index:2147483647;           /* max-ish */
}

/* make sure it can receive clicks */
#overlayBg, #overlayBg *{ pointer-events:auto; }

#popup{
  width:100%;
  max-width:440px;
  position:relative;
  transform: translateY(18px) scale(.96);
  opacity:0;
  transition: opacity .25s ease, transform .25s ease;
}

#overlayBg.show #popup{
  opacity:1;
  transform: translateY(0) scale(1);
}

/* âœ… Close button - inside card area so it doesn't get clipped */
#closePopup{
  position:absolute;
  top:10px;
  right:10px;
  width:44px;
  height:44px;
  border-radius:999px;
  background:rgba(0,0,0,.65);
  border:1px solid rgba(255,255,255,.18);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  cursor:pointer;
  color:#fff;
  z-index:2147483647;
  box-shadow:0 10px 30px rgba(0,0,0,.6);
}
#closePopup:hover{ background:rgba(0,0,0,.85); }

/* ===== POPUP CARD ===== */
.box{
  width:100%;
  background:#141420;
  padding:16px;
  padding-top:56px; /* space for close button */
  border-radius:18px;
  box-shadow:0 30px 80px rgba(0,0,0,.75);
  border:1px solid rgba(255,255,255,.06);
}

h2{text-align:center;margin:8px 0 14px;font-size:26px;}

.imgWrap{
  border:1px solid #2a2a3a;
  border-radius:14px;
  overflow:hidden;
  background:#0f0f16;
  aspect-ratio:1/1;
  position:relative;
  display:flex;
  align-items:center;
  justify-content:center;
}

img{
  width:100%;
  height:100%;
  object-fit:contain;
  display:block;
  opacity:0;
  transition:.3s;
}
img.show{opacity:1;}

.overlay{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  justify-content:flex-end;
  align-items:center;
  gap:10px;
  padding:14px;
  pointer-events:none;
}

.btn{
  pointer-events:auto;
  border:none;
  border-radius:12px;
  padding:12px 14px;
  font-weight:800;
  cursor:pointer;
  width:100%;
  max-width:260px;
  box-shadow:0 12px 30px rgba(0,0,0,.45);
  transition:.25s;
  position:relative;
  overflow:hidden;
}

#spinBtn{background:#fff;color:#111;}
#spinBtn:disabled{opacity:.6;cursor:not-allowed;}

#bookBtn{
  display:none;
  text-decoration:none;
  text-align:center;
  color:#111;
  background:linear-gradient(145deg,#bfbfbf,#8f8f8f,#cfcfcf);
  border:1px solid #666;
  letter-spacing:.5px;
}
#bookBtn:hover{
  transform:translateY(-2px) scale(1.03);
  box-shadow:0 0 10px rgba(255,255,255,.25),
             0 0 25px rgba(255,255,255,.35),
             0 15px 40px rgba(0,0,0,.8);
  border-color:#999;
}
#bookBtn::after{
  content:"";
  position:absolute;
  top:-50%;
  left:-60%;
  width:40%;
  height:200%;
  background:linear-gradient(120deg,transparent,rgba(255,255,255,.5),transparent);
  transform:rotate(25deg);
  animation:shine 4s infinite;
}
@keyframes shine{0%{left:-60%;}60%{left:140%;}100%{left:140%;}}

.subscribe{
  margin-top:10px;
  font-size:12px;
  color:#bbb;
  text-align:center;
  line-height:1.4;
}

form{margin-top:10px;}
input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:none;
  font-size:16px;
  outline:none;
}
.kirjaudu{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:none;
  margin-top:10px;
  font-weight:800;
  background:red;
  color:#fff;
  cursor:pointer;
}
.kirjaudu:disabled{opacity:.6;cursor:not-allowed;}
.status{
  margin-top:8px;
  font-size:12px;
  color:#bbb;
  min-height:16px;
  text-align:center;
}

canvas{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:999; /* confetti below overlay z-index */
}
</style>
</head>

<body>

<canvas id="confetti"></canvas>

<!-- ===== POPUP WRAPPER ===== -->
<div id="overlayBg" aria-hidden="true">
  <div id="popup" role="dialog" aria-modal="true">
    <button id="closePopup" aria-label="Close" type="button">âœ•</button>

    <div class="box">
      <h2>ðŸ”¥ Tattoo Of The Day</h2>

      <div class="imgWrap">
        <img id="img" alt="Tattoo">
        <div class="overlay">
          <button id="spinBtn" class="btn" type="button">SPIN</button>

          <a id="bookBtn" class="btn" target="_blank" rel="noreferrer"
            href="https://form.jotform.com/Tattoo_inkyvibestattoo/Ajanvaraus?fbclid=PARlRTSAP5nc9leHRuA2FlbQIxMQBzcnRjBmFwcF9pZA8xMjQwMjQ1NzQyODc0MTQAAaeJWYt19SRUJabHyW8cn5FAtLdSgUxnV78s6aMlFszcakFsiYxeuzap44crrw_aem_KcBzF0S4BQzaCSgtwB9LEQ">
            Varaa Aika Nyt
          </a>
        </div>
      </div>

      <div class="subscribe">
        Tilaa Ink Vibes -tatuointisÃ¤hkÃ¶postit saadaksesi eksklusiivisia tarjouksia, alennuksia, viimeisimmÃ¤t uutiset ja inspiroivaa sisÃ¤ltÃ¶Ã¤.
      </div>

      <iframe name="hidden_iframe" style="display:none;"></iframe>

      <form id="phoneForm" method="POST" target="hidden_iframe"
            action="https://script.google.com/macros/s/AKfycbwYEegtNF44clO31rVT0XQJxSmsqr_FwhY6QvdbvF9n2bJUYUrcKp_Izm3y_OUhHFJcUw/exec">
        <input id="phone" name="phone" type="tel" inputmode="tel" autocomplete="tel" value="+358 " required>
        <button id="submitBtn" class="kirjaudu" type="submit">Kirjaudu</button>
        <div id="status" class="status"></div>
      </form>
    </div>

  </div>
</div>

<script>
/* ===== POPUP OPEN AFTER 5s + CLOSE ===== */
const overlayBg = document.getElementById("overlayBg");
const closePopup = document.getElementById("closePopup");

/* âœ… EÄŸer kapatÄ±nca bir daha aÃ§Ä±lmasÄ±n istiyorsan bu kalsÄ±n.
   Ä°stemiyorsan POPUP_KEY ile ilgili 3 satÄ±rÄ± sil. */
const POPUP_KEY = "inkvibes_popup_closed";

function openPopup(){
  overlayBg.style.display = "flex";
  overlayBg.setAttribute("aria-hidden","false");
  requestAnimationFrame(() => overlayBg.classList.add("show"));
}

function closePopupFn(){
  overlayBg.classList.remove("show");
  overlayBg.setAttribute("aria-hidden","true");
  setTimeout(() => overlayBg.style.display = "none", 200);

  // kapandÄ± diye kaydet (istersen kaldÄ±r)
  try{ localStorage.setItem(POPUP_KEY, "1"); }catch(e){}
}

// open after 5 seconds (only if not closed before)
let canOpen = true;
try{ if (localStorage.getItem(POPUP_KEY)) canOpen = false; }catch(e){}

if (canOpen) setTimeout(openPopup, 5000);

// close button
closePopup.addEventListener("click", closePopupFn);

// click on dark background closes too
overlayBg.addEventListener("click", (e) => {
  if (e.target === overlayBg) closePopupFn();
});
</script>

<script>
/* ===== images ===== */
const LOGO="logo1.jpg";
const TOTAL=31;
const tattoos=[...Array(TOTAL)].map((_,i)=>`tattoo${i+1}.jpg`);

const img=document.getElementById("img");
const spinBtn=document.getElementById("spinBtn");
const bookBtn=document.getElementById("bookBtn");

/* ===== 24h lock ===== */
const KEY="tattoo24";
const DAY=24*60*60*1000;

img.src=LOGO;
img.onload=()=>img.classList.add("show");

function setImg(s){img.classList.remove("show");setTimeout(()=>img.src=s,120);}

function loadLock(){
  try{
    const d=JSON.parse(localStorage.getItem(KEY));
    if(!d || Date.now()>d.until) return null;
    if(typeof d.i!=="number" || d.i<0 || d.i>=tattoos.length) return null;
    return d;
  }catch{return null;}
}
function saveLock(i){localStorage.setItem(KEY,JSON.stringify({i,until:Date.now()+DAY}));}

function spinAnim(final){
  spinBtn.disabled=true;
  bookBtn.style.display="none";

  let c=Math.floor(Math.random()*tattoos.length),delay=55;
  (function step(n){
    if(n>28){
      setImg(tattoos[final]);
      confetti(1400);
      spinBtn.disabled=false;
      bookBtn.style.display="block";
      return;
    }
    c=(c+1+Math.floor(Math.random()*3))%tattoos.length;
    img.src=tattoos[c];
    img.classList.add("show");
    delay=Math.round(delay*1.15);
    setTimeout(()=>step(n+1),delay);
  })(0);
}

const locked=loadLock();
if(locked){
  setImg(tattoos[locked.i]);
  bookBtn.style.display="block";
}

spinBtn.onclick=()=>{
  const l=loadLock();
  if(l){
    setImg(tattoos[l.i]);
    bookBtn.style.display="block";
    return;
  }
  const pick=Math.floor(Math.random()*tattoos.length);
  saveLock(pick);
  spinAnim(pick);
};
</script>

<script>
/* ===== phone submit UI + validation ===== */
const form=document.getElementById("phoneForm");
const phoneEl=document.getElementById("phone");
const statusEl=document.getElementById("status");
const submitBtn=document.getElementById("submitBtn");

function normalizePhone(p){ return p.replace(/[^\d+]/g,"").trim(); }
function validFI(p){
  if(!p.startsWith("+358")) return false;
  const rest=p.slice(4);
  return /^\d+$/.test(rest) && rest.length>=7 && rest.length<=12;
}

form.addEventListener("submit",(e)=>{
  const phone = normalizePhone(phoneEl.value);
  phoneEl.value = phone;

  if(!validFI(phone)){
    e.preventDefault();
    statusEl.textContent="SyÃ¶tÃ¤ kelvollinen numero: +358401234567";
    return;
  }

  statusEl.textContent="LiitytÃ¤Ã¤n...";
  submitBtn.disabled=true;

  setTimeout(()=>{
    statusEl.textContent="Liitytty âœ…";
    submitBtn.disabled=false;
    phoneEl.value="+358 ";
  }, 1200);
});
</script>

<script>
/* ===== confetti ===== */
const c=document.getElementById("confetti"),x=c.getContext("2d");
function rs(){
  c.width=innerWidth*devicePixelRatio;
  c.height=innerHeight*devicePixelRatio;
  x.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
}
window.addEventListener("resize",rs); rs();
function r(a,b){return Math.random()*(b-a)+a;}
function confetti(ms){
  const s=performance.now();
  const p=[...Array(140)].map(()=>({
    x:r(0,innerWidth), y:r(-20,-10),
    vx:r(-2,2), vy:r(2,5),
    sz:r(6,10), rt:r(0,6),
    vr:r(-.1,.1), c:`hsl(${r(0,360)} 90% 60%)`
  }));
  (function t(k){
    x.clearRect(0,0,innerWidth,innerHeight);
    p.forEach(o=>{
      o.vy+=.06; o.x+=o.vx; o.y+=o.vy; o.rt+=o.vr;
      x.save(); x.translate(o.x,o.y); x.rotate(o.rt);
      x.fillStyle=o.c;
      x.fillRect(-o.sz/2,-o.sz/2,o.sz,o.sz*.6);
      x.restore();
    });
    if(k-s<ms) requestAnimationFrame(t);
    else x.clearRect(0,0,innerWidth,innerHeight);
  })(performance.now());
}
</script>

</body>
</html>